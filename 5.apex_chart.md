ขั้นตอนสำหรับการสร้าง Line Chart ที่แสดงข้อมูลอุณหภูมิและความชื้น โดยใช้ [ApexCharts](https://apexcharts.com/) ในฝั่ง Client และดึงข้อมูลจากอุปกรณ์ ESP32 ผ่าน Express API บนฝั่ง Server 

---

## 1. สิ่งที่ต้องเตรียม
- **Node.js และ npm**: สำหรับรัน Express API
- **Express**: ใช้สร้าง API server
- **ApexCharts**: ไลบรารีสำหรับแสดงกราฟบนเว็บ
- **ESP32**: (สำหรับตัวอย่างนี้จะใช้ข้อมูลจำลอง) โดยทั่วไป ESP32 จะส่งข้อมูลอุณหภูมิและความชื้นไปยัง API

---

## 2. สร้าง Express API

### 2.1 เริ่มโปรเจกต์ Node.js
1. เปิด Terminal แล้วสร้างโฟลเดอร์โปรเจกต์ใหม่ เช่น `apexcharts-tutorial`
2. รันคำสั่ง:
   ```bash
   npm init -y
   ```
3. ติดตั้ง Express:
   ```bash
   npm install express
   ```

### 2.2 เขียนโค้ดสำหรับ Express API
สร้างไฟล์ชื่อ `server.js` แล้วใส่โค้ดดังต่อไปนี้:
  
```javascript
// server.js
const express = require('express');
const app = express();
const port = 3000;

// สำหรับตัวอย่างนี้ เราจะใช้ข้อมูลจำลอง (simulate data) 
// โดยข้อมูลเหล่านี้จะถูกส่งมาจาก ESP32 จริงๆ ในโปรเจกต์จริง ให้แทนที่ด้วยข้อมูลที่รับมาจาก ESP32
let sensorData = [
  { time: '12:00', temperature: 25, humidity: 60 },
  { time: '12:05', temperature: 26, humidity: 62 },
  { time: '12:10', temperature: 25.5, humidity: 61 },
  { time: '12:15', temperature: 26.2, humidity: 63 },
  { time: '12:20', temperature: 25.8, humidity: 60 }
];

// สร้าง API endpoint สำหรับดึงข้อมูล
app.get('/api/data', (req, res) => {
  res.json(sensorData);
});

app.listen(port, () => {
  console.log(`Server running on http://localhost:${port}`);
});
```

### 2.3 รัน Server
ใน Terminal รันคำสั่ง:
```bash
node server.js
```
จะเห็นข้อความ `Server running on http://localhost:3000` ซึ่งหมายความว่า API ของเราพร้อมทำงาน

---

## 3. สร้างหน้าเว็บสำหรับแสดงกราฟด้วย ApexCharts

### 3.1 สร้างไฟล์ HTML
สร้างไฟล์ `index.html` ในโฟลเดอร์เดียวกับ `server.js` แล้วใส่โค้ดดังนี้:

```html
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <title>Temperature &amp; Humidity Chart</title>
  <!-- โหลด ApexCharts ผ่าน CDN -->
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    #chart {
      max-width: 800px;
      margin: 35px auto;
    }
  </style>
</head>
<body>
  <h2>กราฟแสดงอุณหภูมิและความชื้น</h2>
  <div id="chart"></div>
  
  <script>
    // ฟังก์ชันสำหรับดึงข้อมูลจาก Express API
    async function fetchData() {
      try {
        const response = await fetch('http://localhost:3000/api/data');
        const data = await response.json();
        return data;
      } catch (error) {
        console.error('เกิดข้อผิดพลาดในการดึงข้อมูล:', error);
      }
    }

    // ฟังก์ชันสำหรับเรนเดอร์กราฟด้วย ApexCharts
    async function renderChart() {
      const sensorData = await fetchData();

      // เตรียมข้อมูลสำหรับ ApexCharts
      const categories = sensorData.map(item => item.time);
      const temperatureSeries = sensorData.map(item => item.temperature);
      const humiditySeries = sensorData.map(item => item.humidity);

      var options = {
        chart: {
          type: 'line',
          height: 350
        },
        series: [
          {
            name: 'อุณหภูมิ (°C)',
            data: temperatureSeries
          },
          {
            name: 'ความชื้น (%)',
            data: humiditySeries
          }
        ],
        xaxis: {
          categories: categories,
          title: {
            text: 'เวลา'
          }
        },
        // กำหนด y-axis แยกสำหรับอุณหภูมิและความชื้น (สามารถปรับแต่งเพิ่มเติมได้)
        yaxis: [{
          title: {
            text: 'อุณหภูมิ (°C)'
          }
        }, {
          opposite: true,
          title: {
            text: 'ความชื้น (%)'
          }
        }],
        tooltip: {
          shared: true,
          intersect: false
        }
      };

      var chart = new ApexCharts(document.querySelector("#chart"), options);
      chart.render();
    }

    // เรียกใช้งานฟังก์ชันเรนเดอร์กราฟ
    renderChart();
  </script>
</body>
</html>
```
